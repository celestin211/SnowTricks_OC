# Requêtage : Totaux d'utilisateurs

Note : Un même utilisateur peut avoir plusieurs profils.

## Super-administrateurs

Toutes ressources globales confondues.

```sql
SELECT COUNT(*)
FROM UTILISATEUR
WHERE ROLES LIKE '%"ROLE_SUPER_ADMIN"%';
```

## Annuaire des compétences

### Tous les utilisateurs

Hormis ceux étant uniquement super-administrateurs.

```sql
SELECT COUNT(*)
FROM UTILISATEUR
INNER JOIN RESSOURCE_GLOBALE_UTILISATEUR ON UTILISATEUR.ID = RESSOURCE_GLOBALE_UTILISATEUR.UTILISATEUR_ID
    AND (RESSOURCE_GLOBALE_UTILISATEUR.DATE_FIN IS NULL OR RESSOURCE_GLOBALE_UTILISATEUR.DATE_FIN < SYSDATE)
INNER JOIN RESSOURCE_GLOBALE ON RESSOURCE_GLOBALE.ID = RESSOURCE_GLOBALE_UTILISATEUR.RESSOURCE_GLOBALE_ID
    AND RESSOURCE_GLOBALE.LIBELLE_LONG LIKE 'Annuaire des compétences de la DGE'
WHERE UTILISATEUR.LOCKED = 0
;
```

### Administrateurs

```sql
SELECT COUNT(DISTINCT UTILISATEUR.ID)
FROM UTILISATEUR
INNER JOIN PROFIL_UTILISATEUR ON UTILISATEUR.ID = PROFIL_UTILISATEUR.UTILISATEUR_ID
INNER JOIN PROFIL ON PROFIL_UTILISATEUR.PROFIL_ID = PROFIL.ID
    AND PROFIL.LIBELLE LIKE 'Administrateur'
INNER JOIN RESSOURCE_GLOBALE ON PROFIL.RESSOURCE_GLOBALE_ID = RESSOURCE_GLOBALE.ID
    AND RESSOURCE_GLOBALE.LIBELLE_LONG LIKE 'Annuaire des compétences de la DGE'
INNER JOIN RESSOURCE_GLOBALE_UTILISATEUR ON UTILISATEUR.ID = RESSOURCE_GLOBALE_UTILISATEUR.UTILISATEUR_ID
    AND RESSOURCE_GLOBALE.ID = RESSOURCE_GLOBALE_UTILISATEUR.RESSOURCE_GLOBALE_ID
    AND (RESSOURCE_GLOBALE_UTILISATEUR.DATE_FIN IS NULL OR RESSOURCE_GLOBALE_UTILISATEUR.DATE_FIN < SYSDATE)
WHERE UTILISATEUR.LOCKED = 0
;
```

### Agents

```sql
SELECT COUNT(DISTINCT UTILISATEUR.ID)
FROM UTILISATEUR
INNER JOIN PROFIL_UTILISATEUR ON UTILISATEUR.ID = PROFIL_UTILISATEUR.UTILISATEUR_ID
INNER JOIN PROFIL ON PROFIL_UTILISATEUR.PROFIL_ID = PROFIL.ID
    AND PROFIL.LIBELLE LIKE 'Agent'
INNER JOIN RESSOURCE_GLOBALE ON PROFIL.RESSOURCE_GLOBALE_ID = RESSOURCE_GLOBALE.ID
    AND RESSOURCE_GLOBALE.LIBELLE_LONG LIKE 'Annuaire des compétences de la DGE'
INNER JOIN RESSOURCE_GLOBALE_UTILISATEUR ON UTILISATEUR.ID = RESSOURCE_GLOBALE_UTILISATEUR.UTILISATEUR_ID
    AND RESSOURCE_GLOBALE.ID = RESSOURCE_GLOBALE_UTILISATEUR.RESSOURCE_GLOBALE_ID
    AND (RESSOURCE_GLOBALE_UTILISATEUR.DATE_FIN IS NULL OR RESSOURCE_GLOBALE_UTILISATEUR.DATE_FIN < SYSDATE)
WHERE UTILISATEUR.LOCKED = 0
;
```

### Autres profils

```sql
SELECT COUNT(DISTINCT UTILISATEUR.ID)
FROM UTILISATEUR
INNER JOIN PROFIL_UTILISATEUR ON UTILISATEUR.ID = PROFIL_UTILISATEUR.UTILISATEUR_ID
INNER JOIN PROFIL ON PROFIL_UTILISATEUR.PROFIL_ID = PROFIL.ID
    AND PROFIL.LIBELLE NOT LIKE 'Administrateur'
    AND PROFIL.LIBELLE NOT LIKE 'Agent'
INNER JOIN RESSOURCE_GLOBALE ON PROFIL.RESSOURCE_GLOBALE_ID = RESSOURCE_GLOBALE.ID
    AND RESSOURCE_GLOBALE.LIBELLE_LONG LIKE 'Annuaire des compétences de la DGE'
INNER JOIN RESSOURCE_GLOBALE_UTILISATEUR ON UTILISATEUR.ID = RESSOURCE_GLOBALE_UTILISATEUR.UTILISATEUR_ID
    AND RESSOURCE_GLOBALE.ID = RESSOURCE_GLOBALE_UTILISATEUR.RESSOURCE_GLOBALE_ID
    AND (RESSOURCE_GLOBALE_UTILISATEUR.DATE_FIN IS NULL OR RESSOURCE_GLOBALE_UTILISATEUR.DATE_FIN < SYSDATE)
WHERE UTILISATEUR.LOCKED = 0
;
```
